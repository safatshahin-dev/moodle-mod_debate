define ("mod_debate/debate_view",["jquery","core/ajax","core/str","core/config","core/notification","core/templates"],function(a,b,c,d,e,f){var g={init:function init(c,d,h,i,j,k,l,m,n,o,p){var q=0,r="",s="",t=null,u="",v="",w="",x="",y=!1,z=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();a.getAllocation=function(a){console.log(a);var c=b.call([{methodname:"mod_debate_check_response_allocation",args:{courseid:i,debateid:j,debatetype:parseInt(k),attribute:a,positive_response:l,negative_response:m,userid:h}}]);c[0].done(function(a){y=a.result;console.log(y);if(!y){e.addNotification({message:a.message,type:"info"})}}).fail(e.exception)};a.animateToDiv=function(){a("html, body").animate({scrollTop:a(".mod-debate-topic-container").offset().top},2e3)};a(".mod-debate-response-input").keyup(function(){z(function(){a("div").remove(".mod-debate-find-response");var c=a(s).val();if(0<c.length){var d=b.call([{methodname:"mod_debate_find_debate_respose",args:{courseid:i,debateid:j,response:c,responsetype:q}}]);d[0].done(function(b){if(b.result){var c=JSON.parse(b.data);if(a("#mod-debate-insert-postive-response").is(":visible")||a("#mod-debate-insert-negative-response").is(":visible")){f.render("mod_debate/debate_find_response",{found_response:c}).then(function(b){var c=a(r);c.after(b)}).fail(e.exception)}}}).fail(e.exception)}},700)});a(document).on("click",".mod-debate-negative-delete",function(){t=a(this).attr("data-id");if(0<m){m=m-1}g.deleteResponse(i,j,t)});a(document).on("click",".mod-debate-positive-delete",function(){t=a(this).attr("data-id");if(0<l){l=l-1}g.deleteResponse(i,j,t)});a(document).on("click",".mod-debate-negative-edit",function(){t=a(this).attr("data-id");u="#element"+t;v="#element"+t+"container";if(a("#mod-debate-insert-postive-response").is(":hidden")&&a("#mod-debate-insert-negative-response").is(":hidden")){var b=a(u).text().trim();q=0;r="#mod-debate-insert-negative-response";s="#mod-debate-negative-response-input";w="mod-debate-negative-edit";x="mod-debate-negative-delete";a(s).val(b);a(s).html(b);a(v).css("display","none");a(r).css("display","block");a.animateToDiv()}else{g.renderNotification(0,"info")}});a(document).on("click",".mod-debate-positive-edit",function(){t=a(this).attr("data-id");u="#element"+t;v="#element"+t+"container";if(a("#mod-debate-insert-negative-response").is(":hidden")&&a("#mod-debate-insert-postive-response").is(":hidden")){var b=a(u).text().trim();q=1;r="#mod-debate-insert-postive-response";s="#mod-debate-positive-response-input";w="mod-debate-positive-edit";x="mod-debate-positive-delete";a(s).val(b);a(s).html(b);a(v).css("display","none");a(r).css("display","block");a.animateToDiv()}else{g.renderNotification(0,"info")}});a(document).on("click",".mod-debate-positive-icon",function(){a.getAllocation("positive");console.log(y);if(y){if(a("#mod-debate-insert-negative-response").is(":hidden")&&a("#mod-debate-insert-postive-response").is(":hidden")){q=1;r="#mod-debate-insert-postive-response";s="#mod-debate-positive-response-input";w="mod-debate-positive-edit";x="mod-debate-positive-delete";a(s).val("");a(r).css("display","block");t=null}else{g.renderNotification(0,"info")}}});a(document).on("click",".mod-debate-negative-icon",function(){a.getAllocation("negative");if(y){if(a("#mod-debate-insert-postive-response").is(":hidden")&&a("#mod-debate-insert-negative-response").is(":hidden")){q=0;r="#mod-debate-insert-negative-response";s="#mod-debate-negative-response-input";w="mod-debate-negative-edit";x="mod-debate-negative-delete";a(s).val("");a(r).css("display","block");t=null}else{g.renderNotification(0,"info")}}});a(document).on("click","#mod-debate-cancel-respose",function(){a(r).css("display","none");a(v).css("display","block");a("div").remove(".mod-debate-find-response")});a(document).on("click","#mod-debate-update-response",function(){a("div").remove(".mod-debate-find-response");var h=a(s).val();if(0<h.length){var k=b.call([{methodname:"mod_debate_add_debate_respose",args:{courseid:i,debateid:j,response:h,responsetype:q,id:t}}]);k[0].done(function(b){if(b.result){if(0===q){m++}else{l++}a(r).css("display","none");a("div").remove(".mod-debate-find-response");a(v).remove();if(null===t&&a.isNumeric(b.id)){t=b.id}var i={user_profile_image:d,user_full_name:c,response:h,elementidcontainer:"element"+t+"container",elementid:"element"+t,user_capability:n,user_edit_capability:o,user_delete_capability:p,id:t,editid:w,deleteid:x};f.render("mod_debate/debate_response_output",i).then(function(b){var c=a(r);c.after(b);t=null;a("div").remove(".mod-debate-find-response");v="";u=""}).fail(e.exception)}else{g.renderNotification(2,"error")}a("div").remove(".mod-debate-find-response")}).fail(e.exception)}else{g.renderNotification(1,"info")}})},deleteResponse:function deleteResponse(d,f,h){c.get_strings([{key:"confirm_delete",component:"mod_debate"}]).done(function(c){if(confirm(c[0])){var i=b.call([{methodname:"mod_debate_delete_debate_respose",args:{courseid:d,debateid:f,id:h}}]);i[0].done(function(b){if(b.result){a("#element"+h+"container").remove()}else{g.renderNotification(3,"info")}}).fail(e.exception)}})},renderNotification:function renderNotification(a,b){c.get_strings([{key:"edit_mode_active",component:"mod_debate"},{key:"empty_response",component:"mod_debate"},{key:"error_add",component:"mod_debate"},{key:"error_delete",component:"mod_debate"}]).done(function(c){e.addNotification({message:c[a],type:b})})}};return g});
//# sourceMappingURL=debate_view.min.js.map
